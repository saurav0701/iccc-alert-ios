name: iOS Build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    name: Build iOS App
    runs-on: macos-13
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
    
    - name: Select Xcode Version
      run: sudo xcode-select -s /Applications/Xcode_15.0.app
    
    - name: Show Xcode Version
      run: xcodebuild -version
    
    - name: Create Xcode Project
      run: |
        mkdir -p ICCCAlert.xcodeproj
        cat > ICCCAlert.xcodeproj/project.pbxproj << 'EOF'
        // !$*UTF8*$!
        {
          archiveVersion = 1;
          classes = {};
          objectVersion = 56;
          objects = {
            1A2B3C4D5E6F7G8H9I0J = {
              isa = PBXBuildFile;
              fileRef = 2B3C4D5E6F7G8H9I0J1K;
            };
            2B3C4D5E6F7G8H9I0J1K = {
              isa = PBXFileReference;
              lastKnownFileType = sourcecode.swift;
              path = ICCCAlertApp.swift;
              sourceTree = "<group>";
            };
            3C4D5E6F7G8H9I0J1K2L = {
              isa = PBXGroup;
              children = (
                2B3C4D5E6F7G8H9I0J1K,
              );
              path = ICCCAlert;
              sourceTree = "<group>";
            };
          };
          rootObject = 4D5E6F7G8H9I0J1K2L3M;
        }
        EOF
    
    - name: Build for Simulator
      run: |
        xcodebuild \
          -project ICCCAlert.xcodeproj \
          -scheme ICCCAlert \
          -destination 'platform=iOS Simulator,name=iPhone 14,OS=latest' \
          -configuration Debug \
          build \
          CODE_SIGN_IDENTITY="" \
          CODE_SIGNING_REQUIRED=NO \
          CODE_SIGNING_ALLOWED=NO
    
    - name: Upload Build Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: ICCCAlert-Simulator-Build
        path: build/
        retention-days: 7
        
