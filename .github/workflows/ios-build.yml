name: iOS Build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    name: Build iOS App
    runs-on: macos-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
    
    - name: Show Environment
      run: |
        echo "ğŸ“± Xcode version:"
        xcodebuild -version
        echo ""
        echo "ğŸ”¨ Swift version:"
        swift --version
        echo ""
        echo "ğŸ“ Project structure:"
        find . -name "*.swift" -o -name "Package.swift" | sort
    
    - name: Resolve Dependencies
      run: |
        echo "ğŸ“¦ Resolving Swift Package dependencies..."
        swift package resolve
    
    - name: Build Swift Package
      run: |
        echo "ğŸ”¨ Building ICCCAlert..."
        swift build -c debug
    
    - name: Build Success
      run: |
        echo "âœ… Build completed successfully!"
        echo "ğŸ“¦ Build artifacts:"
        ls -lh .build/debug/ || echo "No artifacts in expected location"
    
    - name: Upload Build Artifacts
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: ICCCAlert-Build
        path: .build/
        retention-days: 7